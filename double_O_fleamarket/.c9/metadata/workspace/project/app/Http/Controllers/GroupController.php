{"changed":true,"filter":false,"title":"GroupController.php","tooltip":"/project/app/Http/Controllers/GroupController.php","value":"<?php\n\nnamespace App\\Http\\Controllers;\n\nuse Illuminate\\Http\\Request;\nuse Illuminate\\Support\\Facades\\DB;\nuse App\\Fleamarket;\n\nclass GroupController extends Controller\n{\n    function SaveGroup(Request $req){\n        $name = $req->get('flea_name');\n        $text = $req->get('text');\n        $img = $req->file('img_file')->getClientOriginalName();\n\n        $location = $req->get('location');\n        $location_get = $req->get('location_get');\n        $location_1 = $req->get('location_1');\n        $location_2 = $req->get('location_2');\n\n        $user_id = $req->session()->get('user');\n        $user_id = $user_id['id'];\n\n        $time = time();\n        $imageName = $time.'_'.$req->file('img_file')->getClientOriginalName();\n\n        if(!$name){\n            echo \"<script>alert('플리마켓 이름을 입력해주세요!');\n                    history.go(-1);</script>\";\n        }\n        if(!$text){\n            echo \"<script>alert('설명을 입력해주세요!');\n                    history.go(-1);</script>\";\n        }\n        if(!$img){\n            echo \"<script>alert('이미지를 첨부해주세요!');\n                    history.go(-1);</script>\";\n        }\n        if(!$location){\n            echo \"<script>alert('지역을 입력해주세요!');\n                    history.go(-1);</script>\";\n        }\n        if(!$location_get){\n            echo \"<script>alert('지도에 위치를 입력해주세요!');\n                    history.go(-1);</script>\";\n        }\n\n        if ($req->hasFile('img_file')) {\n            if($req->file('img_file')->isValid()) {\n                try {\n                    $req->img_file->move(public_path('user_img'), $imageName);\n                } catch (Illuminate\\Filesystem\\FileNotFoundException $e) {\n                    echo 'error';\n                }\n            }\n        }\n\n        $Fleamarkets = new Fleamarket;\n\n        $Fleamarkets->host_id = $user_id;\n        $Fleamarkets->explain = $text;\n        $Fleamarkets->flea_name = $name;\n        $Fleamarkets->image_name = $imageName;\n        $Fleamarkets->location = $location;\n        $Fleamarkets->address = $location_get;\n        $Fleamarkets->coordinate1 = $location_1;\n        $Fleamarkets->coordinate2 = $location_2;\n\n        $Fleamarkets->save();\n\n        $list = DB::table('fleamarkets')->where('host_id','=',$user_id)->get();\n\n        $user_id = $req->session()->get('user');\n        $host_id = $user_id['id'];\n        \n        echo \"<script>alert('グループが作られました！');\n                    location.href='/fleamarket/main';</script>\";\n\n        // return view('contents/flea/flea_group_list')->with('lists',$list)->with('user_id',$host_id);\n    }\n\n    function GroupList(Request $req){\n\n        $user_id = $req->session()->get('user');\n        $host_id = $user_id['id'];\n        $list = DB::table('fleamarkets')->where('host_id','=',$host_id)->get();\n        return view('contents/flea/flea_group_list')->with('lists',$list)->with('user_id',$host_id);\n    }\n\n    function delGroup(Request $req){\n        $group_name = $req->get('group_name');\n        $user_id = $req->get('user_id');\n\n        DB::table('fleamarkets')->where('flea_name', '=', $group_name)->where('host_id', '=', $user_id)->delete();\n\n        $result = $req->input('group_name');\n        $callback = $req->input('callback');\n        echo $callback.\"(\".json_encode($result).\")\";\n\n        return;   \n    }\n\n    function flea_open(Request $req){\n\n    }\n}\n","undoManager":{"mark":7,"position":10,"stack":[[{"start":{"row":75,"column":29},"end":{"row":75,"column":44},"action":"remove","lines":["그룹 생성이 완료되었습니다."],"id":99},{"start":{"row":75,"column":29},"end":{"row":75,"column":30},"action":"insert","lines":["G"]}],[{"start":{"row":75,"column":30},"end":{"row":75,"column":31},"action":"insert","lines":["U"],"id":100}],[{"start":{"row":75,"column":30},"end":{"row":75,"column":31},"action":"remove","lines":["U"],"id":101}],[{"start":{"row":75,"column":29},"end":{"row":75,"column":30},"action":"remove","lines":["G"],"id":102}],[{"start":{"row":75,"column":29},"end":{"row":75,"column":33},"action":"insert","lines":["グループ"],"id":111}],[{"start":{"row":75,"column":33},"end":{"row":75,"column":34},"action":"insert","lines":["が"],"id":116}],[{"start":{"row":75,"column":34},"end":{"row":75,"column":40},"action":"insert","lines":["作られました"],"id":131}],[{"start":{"row":75,"column":40},"end":{"row":75,"column":41},"action":"insert","lines":["！"],"id":132}],[{"start":{"row":99,"column":15},"end":{"row":99,"column":16},"action":"insert","lines":[" "],"id":133}],[{"start":{"row":99,"column":16},"end":{"row":99,"column":17},"action":"insert","lines":[" "],"id":134}],[{"start":{"row":99,"column":17},"end":{"row":99,"column":18},"action":"insert","lines":[" "],"id":135}]]},"ace":{"folds":[],"scrolltop":1440,"scrollleft":0,"selection":{"start":{"row":89,"column":36},"end":{"row":89,"column":36},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":82,"state":"php-start","mode":"ace/mode/php"}},"timestamp":1505647174127}